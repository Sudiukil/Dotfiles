#!/bin/zsh

# cheat.sh shortcut
function cheatsheet { curl http://cheat.sh/$1 }

# SSH tunnel QoL
# Params: server URL
function sstun {
  [ -z "$1" ] && echo "ERROR: No host specified." && return
  if screen -ls | grep "^.[0-9]+\." | cut -f 2 | cut -d '.' -f 2 | grep "^stun$" > /dev/null; then
    echo "ERROR: A screen named 'stun' already exists." && return
  fi
  ssh "$1" exit # Just to trigger credentials caching if any (e.g. keychain)
  screen -dmS stun ssh -vTND 2222 "$1"
}

function unlock {
  eval $(keychain --eval --agents 'ssh,gpg' $(gpg -k | grep "^ " | sed -e 's/ //g'))
  find "$HOME/.ssh/rsa" -type f ! -name "*.pub" | while read -r i; do
    SSH_ASKPASS="$HOME/.ssh/askpass.sh" ssh-add "$i" <<< $(pass "ssh_$(basename $i)")
  done
}